#include <stdio.h>
#include <string.h>
#include <stdlib.h>

#define MAX_LEN 1000

typedef struct {
    char data[MAX_LEN];
    int top;
} Stack;

void initStack(Stack *s) { s->top = -1; }
int isEmpty(Stack *s) { return s->top == -1; }
int isFull(Stack *s) { return s->top == MAX_LEN - 1; }
void push(Stack *s, char c) {
    if (!isFull(s)) s->data[++(s->top)] = c;
    else { printf("Stack overflow\n"); exit(1); }
}
char pop(Stack *s) { if (!isEmpty(s)) return s->data[(s->top)--]; return '\0'; }

int isMatchingPair(char open, char close) {
    return (open == '(' && close == ')') ||
           (open == '{' && close == '}') ||
           (open == '[' && close == ']');
}

int isBalanced(const char *expr) {
    Stack s; initStack(&s);
    for (size_t i = 0; i < strlen(expr); i++) {
        char ch = expr[i];
        if (ch == '(' || ch == '{' || ch == '[') push(&s, ch);
        else if (ch == ')' || ch == '}' || ch == ']') {
            if (isEmpty(&s)) return 0;
            char t = pop(&s);
            if (!isMatchingPair(t, ch)) return 0;
        }
    }
    return isEmpty(&s);
}

int main() {
    char expr[MAX_LEN];
    printf("Enter expression (single line):\n");
    if (!fgets(expr, MAX_LEN, stdin)) return 0;
    size_t ln = strlen(expr);
    if (ln > 0 && expr[ln-1] == '\n') expr[ln-1] = '\0';
    if (isBalanced(expr)) printf("The expression is well parenthesized (balanced).\n");
    else printf("The expression is NOT well parenthesized (unbalanced).\n");
    return 0;
}
